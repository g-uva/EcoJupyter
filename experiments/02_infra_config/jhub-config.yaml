# config.yaml
proxy:
  https:
    enabled: false

hub:
  config:
    JupyterHub:
      base_url: "/jupyter"
      tornado_settings:
        xheaders: true
    Authenticator:
      admin_users:
        - shashikant
        - yuri
        - adnan
        - quint
        - goncalo
    DummyAuthenticator:
      password: greendigit2025
    JupyterHub:
      authenticator_class: dummy

singleuser:
  image:
    name: jupyter/datascience-notebook
    tag: latest

  storage:
    extraVolumes:
      - name: powercap
        hostPath:
          path: /sys/class/powercap
          type: Directory
      - name: proc
        hostPath:
          path: /proc
          type: Directory
      - name: containerd-sock
        hostPath:
          path: /run/containerd/containerd.sock
          type: Socket
      - name: nginx-config
        configMap:
          name: scaphandre-nginx-config

    extraVolumeMounts:
      - name: powercap
        mountPath: /sys/class/powercap
      - name: proc
        mountPath: /proc
      - name: containerd-sock
        mountPath: /run/containerd/containerd.sock
        readOnly: true

  extraContainers:
    - name: scaphandre
      image: hubblo/scaphandre:latest
      args:
        - prometheus
        - "--address=0.0.0.0"
        - "--port=8080"
        - "--containers"
      ports:
        - name: rawmetrics
          containerPort: 8080
# Temporary fix
    - name: proxy-metrics
      image: nginx:stable-alpine
      volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/conf.d
      # image: alpine:latest
      # command: ["/bin/sh", "-c"]
      # args:
      #   - |
      #     apk add --no-cache socat netcat-openbsd && \
      #     socat TCP-LISTEN:8081,fork,reuseaddr SYSTEM:"(echo -ne 'HTTP/1.1 200 OK\r\nContent-Type: text/plain; version=0.0.4\r\n\r\n'; cat) < /dev/stdin | nc 127.0.0.1 8080"
      ports:
        - name: metrics
          containerPort: 8081
# spec:
#   rules:
#   - host: mc-a4.lab.uvalight.net
#     http:
#       paths:
#       - path: /jupyter
#         pathType: Prefix
#         backend:
#           service:
#             name: JupyterHub
#             port:
#               number: 80
spec:
  rules:
  - host: mc-a4.lab.uvalight.net
    http:
      paths:
      - path: /jupyter(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: proxy-public
            port:
              number: 80